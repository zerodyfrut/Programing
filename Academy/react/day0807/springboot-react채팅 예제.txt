Spring Boot + React ê¸°ë°˜ì˜ ë‹¨ì¼ ì±„íŒ…ë°© ì• í”Œë¦¬ì¼€ì´ì…˜


[Back - end Spring Boot ì„œë²„]

[build.gradle] - í”„ë¡œì íŠ¸ ë§Œë“¤ë•Œ ì ìš©í•  ê²ƒ(í˜¹ì‹œë‚˜ ëª» ë„£ì—ˆì„ë•ŒëŠ” ë¶™ì—¬ ë„£ê¸°)

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-websocket'
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'com.fasterxml.jackson.core:jackson-databind'
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
}


*ëª¨ë“  í´ë˜ìŠ¤ëŠ” ê¸°ë³¸ íŒ¨í‚¤ì§€ì— ë§Œë“¤ê¸°(í˜¹ì€ í•˜ìœ„ íŒ¨í‚¤ì§€)
[WebSocketConfig.java]

@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {
    @Override
    public void configureMessageBroker(MessageBrokerRegistry config) {
        config.enableSimpleBroker("/topic"); // í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
        config.setApplicationDestinationPrefixes("/app"); // í´ë¼ì´ì–¸íŠ¸ ì „ì†¡ prefix
    }

    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint("/ws-chat")
                .setAllowedOriginPatterns("*")
                .withSockJS(); // fallback ì§€ì›
    }
}

[ChatMessage.java]

@Data
public class ChatMessage {
    private MessageType type;
    private String sender;
    private String content;
    private LocalDateTime timestamp;

    public enum MessageType {
        CHAT, JOIN, LEAVE
    }

    public ChatMessage() {
        this.timestamp = LocalDateTime.now();
    }
}


[ChatController.java]

@Controller
public class ChatController {

    @MessageMapping("/chat.send")
    @SendTo("/topic/public")
    public ChatMessage sendMessage(ChatMessage message) {
        message.setTimestamp(LocalDateTime.now());
        return message;
    }

    @MessageMapping("/chat.newUser")
    @SendTo("/topic/public")
    public ChatMessage newUser(ChatMessage message) {
        message.setTimestamp(LocalDateTime.now());
        message.setType(ChatMessage.MessageType.JOIN);
        return message;
    }
}


----ë¡œì»¬ ì„œë²„ ì£¼ì†Œ: http://localhost:8080/ws-chat------------------


[front end - React í´ë¼ì´ì–¸íŠ¸]

[íŒ¨í‚¤ì§€ ì¶”ê°€ ì„¤ì¹˜]
npm install @stomp/stompjs sockjs-client dayjs


[src/components/ChatApp.jsx]

import React, { useEffect, useState, useRef } from 'react';
import SockJS from 'sockjs-client';
import { CompatClient, Stomp } from '@stomp/stompjs';
import dayjs from 'dayjs';

const ChatApp = () => {
  const [messages, setMessages] = useState([]);
  const [username, setUsername] = useState('');
  const [connected, setConnected] = useState(false);
  const [input, setInput] = useState('');
  const stompClient = useRef(null);

  useEffect(() => {
    //connect();
    return () => disconnect();
  }, []);

  const connect = () => {
    const socket = new SockJS('http://localhost:8080/ws-chat');
    stompClient.current = Stomp.over(socket);

    stompClient.current.connect({}, () => {
      setConnected(true);

      stompClient.current.subscribe('/topic/public', (message) => {
        const data = JSON.parse(message.body);
        setMessages((prev) => [...prev, data]);
      });

      stompClient.current.send('/app/chat.newUser', {}, JSON.stringify({
        sender: username || 'Anonymous',
        type: 'JOIN'
      }));
    });
  };

  const disconnect = () => {
    if (stompClient.current) {
      stompClient.current.disconnect();
      setConnected(false);
    }
  };

  const sendMessage = () => {
    if (stompClient.current && input.trim()) {
      stompClient.current.send('/app/chat.send', {}, JSON.stringify({
        sender: username || 'Anonymous',
        content: input,
        type: 'CHAT'
      }));
      setInput('');
    }
  };

  return (
    <div style={{ padding: 20 }}>
      <h2>ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</h2>

      {!connected && (
        <div>
          <input
            type="text"
            placeholder="ì‚¬ìš©ìëª… ì…ë ¥"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
          />
          <button onClick={connect}>ì ‘ì†í•˜ê¸°</button>
        </div>
      )}

      {connected && (
        <>
          <div style={{ maxHeight: 300, overflowY: 'scroll', border: '1px solid gray', marginBottom: 10 }}>
            {messages.map((msg, idx) => (
              <div key={idx}>
                <span style={{ color: msg.type === 'JOIN' ? 'green' : 'black' }}>
                  {msg.sender}:
                </span> {msg.content || ''} 
                <small style={{ marginLeft: 10, color: '#888' }}>
                  {msg.timestamp ? dayjs(msg.timestamp).format('HH:mm:ss') : ''}
                </small>
              </div>
            ))}
          </div>

          <input
            type="text"
            placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            onKeyDown={(e) => e.key === 'Enter' && sendMessage()}
          />
          <button onClick={sendMessage}>ì „ì†¡</button>
        </>
      )}
    </div>
  );
};

export default ChatApp;





























